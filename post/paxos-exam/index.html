<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Raft 作者出的 Paxos 的试题 | 多颗糖</title>
<meta name="keywords" content="分布式" />
<meta name="description" content="试题 1. (4 分）下面的每张图都显示了一种 Multi-Paxos 服务器上可能的日志（每个条目中的数字代表 acceptedProposal 值）。考虑每份日志都是独立的，下列日志是否可能发生在正确实现的 Multi-Paxos 中？
a. b. c. d. 2. (6 分) 对于 Basic Paxos，假设一个集群有 5 台服务器，其中 3 台接受了(accepted)提案编号 5.1 和对应的提案值 X，在这种情况下，集群中的任意服务器是否有可能接受不同的值 Y ？解释你的答案。
3. (10 分) 假设 Multi-Paxos 集群选出了一个节点作为 Leader，而且没有其它 Leader。此外，假设该节点继续担任一段时间的 Leader，为日志 chosen 了很多命令，并且在这期间依然没有其它节点试图担任 Leader。
a. 在此期间，该节点最少要发送多少轮 Prepare RPC？给出解释，且尽可能精确。
b. 在此期间，该节点最多要发送多少次 Prepare RPC？给出解释，且尽可能精确。
4. (5 分) 当一个 Acceptor 使用 Proposer 提供的 firstUnchosenIndex 来标记被 chosen 的日志记录时，它必须先检查日志记录中的提案编号（acceptedProposal[i] == request.proposal）。假设它跳过了这一检查：请描述一个系统异常的情况。
5. (5 分) 假设提案编号的两个部分（自增 id 和唯一 server_id）进行了互换，即 server_id 位于高位。 a.">
<meta name="author" content="多颗糖">
<link rel="canonical" href="https://tangwz.com/post/paxos-exam/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css" integrity="sha256-yIlj/i15RiAA/Q&#43;xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://tangwz.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://tangwz.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tangwz.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://tangwz.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://tangwz.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.89.4" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-72128068-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="Raft 作者出的 Paxos 的试题" />
<meta property="og:description" content="试题 1. (4 分）下面的每张图都显示了一种 Multi-Paxos 服务器上可能的日志（每个条目中的数字代表 acceptedProposal 值）。考虑每份日志都是独立的，下列日志是否可能发生在正确实现的 Multi-Paxos 中？
a. b. c. d. 2. (6 分) 对于 Basic Paxos，假设一个集群有 5 台服务器，其中 3 台接受了(accepted)提案编号 5.1 和对应的提案值 X，在这种情况下，集群中的任意服务器是否有可能接受不同的值 Y ？解释你的答案。
3. (10 分) 假设 Multi-Paxos 集群选出了一个节点作为 Leader，而且没有其它 Leader。此外，假设该节点继续担任一段时间的 Leader，为日志 chosen 了很多命令，并且在这期间依然没有其它节点试图担任 Leader。
a. 在此期间，该节点最少要发送多少轮 Prepare RPC？给出解释，且尽可能精确。
b. 在此期间，该节点最多要发送多少次 Prepare RPC？给出解释，且尽可能精确。
4. (5 分) 当一个 Acceptor 使用 Proposer 提供的 firstUnchosenIndex 来标记被 chosen 的日志记录时，它必须先检查日志记录中的提案编号（acceptedProposal[i] == request.proposal）。假设它跳过了这一检查：请描述一个系统异常的情况。
5. (5 分) 假设提案编号的两个部分（自增 id 和唯一 server_id）进行了互换，即 server_id 位于高位。 a." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tangwz.com/post/paxos-exam/" /><meta property="og:image" content="https://tangwz.com/"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-10-26T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-10-26T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://tangwz.com/"/>

<meta name="twitter:title" content="Raft 作者出的 Paxos 的试题"/>
<meta name="twitter:description" content="试题 1. (4 分）下面的每张图都显示了一种 Multi-Paxos 服务器上可能的日志（每个条目中的数字代表 acceptedProposal 值）。考虑每份日志都是独立的，下列日志是否可能发生在正确实现的 Multi-Paxos 中？
a. b. c. d. 2. (6 分) 对于 Basic Paxos，假设一个集群有 5 台服务器，其中 3 台接受了(accepted)提案编号 5.1 和对应的提案值 X，在这种情况下，集群中的任意服务器是否有可能接受不同的值 Y ？解释你的答案。
3. (10 分) 假设 Multi-Paxos 集群选出了一个节点作为 Leader，而且没有其它 Leader。此外，假设该节点继续担任一段时间的 Leader，为日志 chosen 了很多命令，并且在这期间依然没有其它节点试图担任 Leader。
a. 在此期间，该节点最少要发送多少轮 Prepare RPC？给出解释，且尽可能精确。
b. 在此期间，该节点最多要发送多少次 Prepare RPC？给出解释，且尽可能精确。
4. (5 分) 当一个 Acceptor 使用 Proposer 提供的 firstUnchosenIndex 来标记被 chosen 的日志记录时，它必须先检查日志记录中的提案编号（acceptedProposal[i] == request.proposal）。假设它跳过了这一检查：请描述一个系统异常的情况。
5. (5 分) 假设提案编号的两个部分（自增 id 和唯一 server_id）进行了互换，即 server_id 位于高位。 a."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://tangwz.com/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Raft 作者出的 Paxos 的试题",
      "item": "https://tangwz.com/post/paxos-exam/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Raft 作者出的 Paxos 的试题",
  "name": "Raft 作者出的 Paxos 的试题",
  "description": "试题 1. (4 分）下面的每张图都显示了一种 Multi-Paxos 服务器上可能的日志（每个条目中的数字代表 acceptedProposal 值）。考虑每份日志都是独立的，下列日志是否可能发生在正确实现的 Multi-Paxos 中？\na. b. c. d. 2. (6 分) 对于 Basic Paxos，假设一个集群有 5 台服务器，其中 3 台接受了(accepted)提案编号 5.1 和对应的提案值 X，在这种情况下，集群中的任意服务器是否有可能接受不同的值 Y ？解释你的答案。\n3. (10 分) 假设 Multi-Paxos 集群选出了一个节点作为 Leader，而且没有其它 Leader。此外，假设该节点继续担任一段时间的 Leader，为日志 chosen 了很多命令，并且在这期间依然没有其它节点试图担任 Leader。\na. 在此期间，该节点最少要发送多少轮 Prepare RPC？给出解释，且尽可能精确。\nb. 在此期间，该节点最多要发送多少次 Prepare RPC？给出解释，且尽可能精确。\n4. (5 分) 当一个 Acceptor 使用 Proposer 提供的 firstUnchosenIndex 来标记被 chosen 的日志记录时，它必须先检查日志记录中的提案编号（acceptedProposal[i] == request.proposal）。假设它跳过了这一检查：请描述一个系统异常的情况。\n5. (5 分) 假设提案编号的两个部分（自增 id 和唯一 server_id）进行了互换，即 server_id 位于高位。 a.",
  "keywords": [
    "分布式"
  ],
  "articleBody": "试题 1. (4 分）下面的每张图都显示了一种 Multi-Paxos 服务器上可能的日志（每个条目中的数字代表 acceptedProposal 值）。考虑每份日志都是独立的，下列日志是否可能发生在正确实现的 Multi-Paxos 中？\na. b. c. d. 2. (6 分) 对于 Basic Paxos，假设一个集群有 5 台服务器，其中 3 台接受了(accepted)提案编号 5.1 和对应的提案值 X，在这种情况下，集群中的任意服务器是否有可能接受不同的值 Y ？解释你的答案。\n3. (10 分) 假设 Multi-Paxos 集群选出了一个节点作为 Leader，而且没有其它 Leader。此外，假设该节点继续担任一段时间的 Leader，为日志 chosen 了很多命令，并且在这期间依然没有其它节点试图担任 Leader。\na. 在此期间，该节点最少要发送多少轮 Prepare RPC？给出解释，且尽可能精确。\nb. 在此期间，该节点最多要发送多少次 Prepare RPC？给出解释，且尽可能精确。\n4. (5 分) 当一个 Acceptor 使用 Proposer 提供的 firstUnchosenIndex 来标记被 chosen 的日志记录时，它必须先检查日志记录中的提案编号（acceptedProposal[i] == request.proposal）。假设它跳过了这一检查：请描述一个系统异常的情况。\n5. (5 分) 假设提案编号的两个部分（自增 id 和唯一 server_id）进行了互换，即 server_id 位于高位。 a. 这会影响 Paxos 的安全性（Safety）吗？请简单解释你的答案。 b. 这会影响 Paxos 的活性（Liveness）吗？请简单解释你的答案。\n6. (10 分) 假设一个 Proposer 以初始值 v1 运行 Basic Paxos，但是它在协议执行过程中或执行后的某个（未知）时间点宕机了。假设该 Proposer 重新启动并从头开始运行协议，使用之前使用的相同的提案编号，但初始值为 v2，这样安全吗？请解释你的答案。\n7. (10 分) 在一个成功的 Accept RPC 中，Acceptor 将其 minProposal 设为 n（Accept RPC 中的提案编号）。描述一个这样做实际上改变了 minProposal 值的场景（即 minProposal 还没有等于 n）。描述如果没有这段代码，系统将出现异常行为的场景。\n8. (10 分) 考虑 Multi-Paxos 的配置变更，旧配置由服务器 1、2 和 3 组成，新配置由服务器 3、4 和 5 组成。假设新配置在日志中第 N 条被 chosen，同时日志记录 N 到 N+α (含)也都被 chosen。假设此时旧服务器 1 和 2 被关闭，因为它们不属于新配置。描述下这可能在系统中引起的问题。\n 答案 1. a. 是。\nb. 是。\nc. 是。\nd. 是。\n2. 是。如果 S1，S2 和 S3 接受了提案 ，其它服务器仍然可能接受更早的提案编号的提案值 Y。\n例如，S4 先发送 Prepare(3.4) 发现并没有已接受的提案值，接着 S1 发送 Prepare（5.1）到 S1，S2，S3，然后 S1，S2，S3 接受了，此时 S4 仍然可能在 S4，S5 完成提案 3. a. 最少只发送 1 轮 Prepare RPC，如果多数派 Prepare 都立即返回了具有 noMoreAccepted=true 的响应。\nb. 最多是： Leader 节点上每有一个未 chosen 但是 Acceptor 已经接受的日志记录，就会有一轮 Prepare RPC。这发生在如果每次 Leader 为其没有 chosen 的日志发送 Prepare 请求，都发现有一个 Acceptor 已经接受了该提案值，那它就会在该条目位置采用这个提案值，然后继续尝试下一个日志条目。这样就会发生最多的轮次。\n4. 可能出现的异常行为是：服务器会标记两个不同的 chosen 值。用 2 个竞争的提案，3 节点集群和 2 个日志来举例：\n S1 完成一轮 Prepare 发送提案编号 n=1.1, index=1 给 S1，S2 S1 只完成 S1（它自己）的 Accept 提案 n=1.1, value = X, index = 1 S2 完成一轮 Prepare 发送提案编号 n=2.2, index=1 给 S2，S3，收到二者包含 noMoreAccepted=true 的响应 S2 完成一轮 Accept，S2、S3 收到 n=2.2, value=Y, index=1 S2 标记 index 1 的日志为 chosen S2 完成一轮 Accept，S1, S2, 和 S3 收到 n=2.2, value=Z, index=2, firstUnchosenIndex=2，此时，S1 将会发生异常：将 n=1.1, value=X 的日志设为 chosen，然后将 X 应用到状态机。这是不正确的，因为实际上是 Y 被 chosen。  5. a. 不会。因为安全性只需要提案编号唯一，每台服务器的 server_id 是唯一的，并且有自增 id，所以唯一性得到保证。\nb. 会。例如，server_id 最大的服务器向集群中每一台服务器发出的 Prepare RPC 将会永远失败。然后，其它 Proposer 无法继续运行，因为其它服务器的 minProposal 对于 Proposer 来说太大了。\n6. 不安全。不同的提案必须具有不同的提案编号。下面是一个 3 节点集群的例子：\n S1 发送 Prepare(n=1.1) 至 S1，S2 S1 发送 Accept(n=1.1, v=v1) 至 S1 S1 重启 S1 发送 Prepare(n=1.1) 至 S2，S3（并且发现还没有被接受的提案） S1 发送 Accept(n=1.1, v=v2) 与 S2，S3 S1 将 v2 被 chosen 返回给客户端 S2 发送 Prepare(n=2.2) 至 S1，S2 并收到响应：  来自 S1: acceptedProposal=1.1, acceptedValue=v1 来自 S2: acceptedProposal=1.1, acceptedValue=v2   S2 直接选择了 v1 作为提案值 S2 发送 Accept(n=2.2, v=v1)至S1，S2，S3 S2 将 v1 被 chosen 返回给客户端  可能出现的另一个问题是，崩溃前的请求在崩溃之后才被送到：\n S1 发送 Prepare(n=1.1) 至 S1，S2 S1 发送 Accept(n=1.1, v=v1) 至 S1 S1 发送 Accept(n=1.1) 至 S2 和 S3，但是它们并没有收到 S1 重启 S1 发送 Prepare(n=1.1) 至 S2，S3（并且发现还没有被接受的提案） S1 发送 Accept(n=1.1, v=v2) 至 S2 和 S3 S1 将 v2 被 chosen 返回给客户端 现在，S2 和 S3 收到了（之前的） Accept(n=1.1, v=v1) 请求，并且覆盖了 acceptedValue 设为 v1。现在集群的状态是 v1 被 chosen，但是客户端收到 v2 被 chosen。  7. 用 5 个节点的 Basic Paxos 举例：\n S1 发送 Prepare(n=1.1) 至 S1, S2, S3（并且发现没有接受的提案） S5 发送 Prepare(n=2.5) 至 S3, S4, S5（并且发现没有接受的提案） S5 发送 Accept(n=2.5, v=X) 至 S2, S3, S5，这时 S2 的 minProposal 应该是 2.5 S5 返回 X 被 chosen 给客户端 S1 发送 Accept(n=1.1, v=Y) 至 S2，这通常会被拒绝，但是如果 Accept 阶段未更新 S2 的 minProposal，这会被接受 S3 发送 Prepare(n=3.3) 至 S1, S2, S4（并且发现 n=1.1, v=Y） S3 发送 Accept(n=3.3, v=Y)至 S1, S2, S3, S4, S5 S3 返回 Y 被 chosen 给客户端  8. 这将导致新集群的活性(liveness)问题，因为新集群服务器上的 firstUnchosenIndex 可能小于 N+α。\n例如，在最坏情况下，S3 可能永久故障了，而 S1 和 S2 则可能没有尝试将任何值同步到 S4 和 S5（仅使用本讲义中介绍的算法）。然后，S4 和 S5 将永远无法学习到日志记录第 1 到 N+α-1 所 chosen 的值，因为它们无法和 S1、S2 或 S3 进行通信。S4 和 S5 的状态机将永远无法超越其初始状态。\n",
  "wordCount" : "516",
  "inLanguage": "en",
  "datePublished": "2020-10-26T00:00:00Z",
  "dateModified": "2020-10-26T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "多颗糖"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://tangwz.com/post/paxos-exam/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "多颗糖",
    "logo": {
      "@type": "ImageObject",
      "url": "https://tangwz.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://tangwz.com/" accesskey="h" title="多颗糖 (Alt + H)">多颗糖</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://tangwz.com/page/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="https://tangwz.com/page/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://tangwz.com/page/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://tangwz.com/">Home</a>&nbsp;»&nbsp;<a href="https://tangwz.com/post/">Posts</a></div>
    <h1 class="post-title">
      Raft 作者出的 Paxos 的试题
    </h1>
    <div class="post-meta"><span title='2020-10-26 00:00:00 +0000 UTC'>October 26, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;多颗糖&nbsp;|&nbsp;<a href="https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content/post/paxos-exam.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%af%95%e9%a2%98" aria-label="试题">试题</a><ul>
                        
                <li>
                    <a href="#1" aria-label="1.">1.</a></li>
                <li>
                    <a href="#2" aria-label="2.">2.</a></li>
                <li>
                    <a href="#3" aria-label="3.">3.</a></li>
                <li>
                    <a href="#4" aria-label="4.">4.</a></li>
                <li>
                    <a href="#5" aria-label="5.">5.</a></li>
                <li>
                    <a href="#6" aria-label="6.">6.</a></li>
                <li>
                    <a href="#7" aria-label="7.">7.</a></li>
                <li>
                    <a href="#8" aria-label="8.">8.</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ad%94%e6%a1%88" aria-label="答案">答案</a><ul>
                        
                <li>
                    <a href="#1-1" aria-label="1.">1.</a></li>
                <li>
                    <a href="#2-1" aria-label="2.">2.</a></li>
                <li>
                    <a href="#3-1" aria-label="3.">3.</a></li>
                <li>
                    <a href="#4-1" aria-label="4.">4.</a></li>
                <li>
                    <a href="#5-1" aria-label="5.">5.</a></li>
                <li>
                    <a href="#6-1" aria-label="6.">6.</a></li>
                <li>
                    <a href="#7-1" aria-label="7.">7.</a></li>
                <li>
                    <a href="#8-1" aria-label="8.">8.</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="试题">试题<a hidden class="anchor" aria-hidden="true" href="#试题">#</a></h1>
<h2 id="1">1.<a hidden class="anchor" aria-hidden="true" href="#1">#</a></h2>
<p>(4 分）下面的每张图都显示了一种 Multi-Paxos 服务器上可能的日志（每个条目中的数字代表 <code>acceptedProposal</code> 值）。考虑每份日志都是独立的，下列日志是否可能发生在正确实现的 Multi-Paxos 中？</p>
<p>a. <img loading="lazy" src="/media/images/20201026-paxos-exam/paxosLoga.png" alt="paxosLoga"  />
</p>
<p>b. <img loading="lazy" src="/media/images/20201026-paxos-exam/paxosLogb.png" alt="paxosLogb"  />
</p>
<p>c. <img loading="lazy" src="/media/images/20201026-paxos-exam/paxosLogc.png" alt="paxosLogc"  />
</p>
<p>d. <img loading="lazy" src="/media/images/20201026-paxos-exam/paxosLogd.png" alt="paxosLogd"  />
</p>
<h2 id="2">2.<a hidden class="anchor" aria-hidden="true" href="#2">#</a></h2>
<p>(6 分) 对于 Basic Paxos，假设一个集群有 5 台服务器，其中 3 台接受了(accepted)提案编号 5.1 和对应的提案值 X，在这种情况下，集群中的<strong>任意服务器</strong>是否有可能接受不同的值 Y ？解释你的答案。</p>
<h2 id="3">3.<a hidden class="anchor" aria-hidden="true" href="#3">#</a></h2>
<p>(10 分) 假设 Multi-Paxos 集群选出了一个节点作为 Leader，而且没有其它 Leader。此外，假设该节点继续担任一段时间的 Leader，为日志 chosen 了很多命令，并且在这期间依然没有其它节点试图担任 Leader。</p>
<p>a. 在此期间，该节点<strong>最少</strong>要发送多少轮 <code>Prepare RPC</code>？给出解释，且尽可能精确。</p>
<p>b. 在此期间，该节点<strong>最多</strong>要发送多少次 <code>Prepare RPC</code>？给出解释，且尽可能精确。</p>
<h2 id="4">4.<a hidden class="anchor" aria-hidden="true" href="#4">#</a></h2>
<p>(5 分) 当一个 Acceptor 使用 Proposer 提供的 <code>firstUnchosenIndex</code> 来标记被 chosen 的日志记录时，它必须先检查日志记录中的提案编号（<code>acceptedProposal[i] == request.proposal</code>）。假设它跳过了这一检查：请描述一个系统异常的情况。</p>
<h2 id="5">5.<a hidden class="anchor" aria-hidden="true" href="#5">#</a></h2>
<p>(5 分) 假设提案编号的两个部分（自增 id 和唯一 server_id）进行了互换，即 <code>server_id</code> 位于高位。
a. 这会影响 Paxos 的安全性（Safety）吗？请简单解释你的答案。
b. 这会影响 Paxos 的活性（Liveness）吗？请简单解释你的答案。</p>
<h2 id="6">6.<a hidden class="anchor" aria-hidden="true" href="#6">#</a></h2>
<p>(10 分) 假设一个 Proposer 以初始值 v1 运行 Basic Paxos，但是它在协议执行过程中或执行后的某个（未知）时间点宕机了。假设该 Proposer 重新启动并从头开始运行协议，使用之前使用的相同的提案编号，但初始值为 v2，这样安全吗？请解释你的答案。</p>
<h2 id="7">7.<a hidden class="anchor" aria-hidden="true" href="#7">#</a></h2>
<p>(10 分) 在一个成功的 <code>Accept RPC</code> 中，Acceptor 将其 <code>minProposal</code> 设为 n（<code>Accept RPC</code> 中的提案编号）。描述一个这样做实际上改变了 <code>minProposal</code> 值的场景（即 <code>minProposal</code> 还没有等于 n）。描述如果没有这段代码，系统将出现异常行为的场景。</p>
<h2 id="8">8.<a hidden class="anchor" aria-hidden="true" href="#8">#</a></h2>
<p>(10 分) 考虑 Multi-Paxos 的配置变更，旧配置由服务器 1、2 和 3 组成，新配置由服务器 3、4 和 5 组成。假设新配置在日志中第 N 条被 chosen，同时日志记录 N 到 N+α (含)也都被 chosen。假设此时旧服务器 1 和 2 被关闭，因为它们不属于新配置。描述下这可能在系统中引起的问题。</p>
<hr>
<h1 id="答案">答案<a hidden class="anchor" aria-hidden="true" href="#答案">#</a></h1>
<h2 id="1-1">1.<a hidden class="anchor" aria-hidden="true" href="#1-1">#</a></h2>
<p>a. 是。</p>
<p>b. 是。</p>
<p>c. 是。</p>
<p>d. 是。</p>
<h2 id="2-1">2.<a hidden class="anchor" aria-hidden="true" href="#2-1">#</a></h2>
<p>是。如果 S1，S2 和 S3 接受了提案 &lt;5.1, X&gt;，其它服务器仍然可能接受<strong>更早的提案编号</strong>的提案值 Y。</p>
<p>例如，S4 先发送 Prepare(3.4) 发现并没有已接受的提案值，接着 S1 发送 Prepare（5.1）到 S1，S2，S3，然后 S1，S2，S3 接受了&lt;5.1, X&gt;，此时 S4 仍然可能在 S4，S5 完成提案 &lt;3.4, Y&gt;</p>
<h2 id="3-1">3.<a hidden class="anchor" aria-hidden="true" href="#3-1">#</a></h2>
<p>a. 最少只发送 1 轮 <code>Prepare RPC</code>，如果多数派 Prepare 都立即返回了具有 <code>noMoreAccepted=true</code> 的响应。</p>
<p>b. 最多是： Leader 节点上每有一个未 chosen 但是 Acceptor 已经接受的日志记录，就会有一轮 <code>Prepare RPC</code>。这发生在如果每次 Leader 为其没有 chosen 的日志发送 <code>Prepare</code> 请求，都发现有一个 Acceptor 已经接受了该提案值，那它就会在该条目位置采用这个提案值，然后继续尝试下一个日志条目。这样就会发生最多的轮次。</p>
<h2 id="4-1">4.<a hidden class="anchor" aria-hidden="true" href="#4-1">#</a></h2>
<p>可能出现的异常行为是：服务器会标记两个不同的 chosen 值。用 2 个竞争的提案，3 节点集群和 2 个日志来举例：</p>
<ul>
<li>S1 完成一轮 Prepare 发送提案编号 n=1.1, index=1 给 S1，S2</li>
<li>S1 只完成 S1（它自己）的 Accept 提案 n=1.1, value = X, index = 1</li>
<li>S2 完成一轮 Prepare 发送提案编号 n=2.2, index=1 给 S2，S3，收到二者包含 <code>noMoreAccepted=true</code> 的响应</li>
<li>S2 完成一轮 Accept，S2、S3 收到 n=2.2, value=Y, index=1</li>
<li>S2 标记 index 1 的日志为 chosen</li>
<li>S2 完成一轮 Accept，S1, S2, 和 S3 收到 n=2.2, value=Z, index=2, firstUnchosenIndex=2，此时，S1 将会发生异常：将 n=1.1, value=X 的日志设为 chosen，然后将 X 应用到状态机。这是不正确的，因为实际上是 Y 被 chosen。</li>
</ul>
<h2 id="5-1">5.<a hidden class="anchor" aria-hidden="true" href="#5-1">#</a></h2>
<p>a. 不会。因为安全性只需要提案编号唯一，每台服务器的 server_id 是唯一的，并且有自增 id，所以唯一性得到保证。</p>
<p>b. 会。例如，server_id 最大的服务器向集群中每一台服务器发出的 <code>Prepare RPC</code> 将会永远失败。然后，其它 Proposer 无法继续运行，因为其它服务器的 <code>minProposal</code> 对于 Proposer 来说太大了。</p>
<h2 id="6-1">6.<a hidden class="anchor" aria-hidden="true" href="#6-1">#</a></h2>
<p>不安全。不同的提案必须具有不同的提案编号。下面是一个 3 节点集群的例子：</p>
<ul>
<li>S1 发送 <code>Prepare(n=1.1)</code> 至 S1，S2</li>
<li>S1 发送 <code>Accept(n=1.1, v=v1)</code> 至 S1</li>
<li>S1 重启</li>
<li>S1 发送  <code>Prepare(n=1.1)</code> 至 S2，S3（并且发现还没有被接受的提案）</li>
<li>S1 发送 <code>Accept(n=1.1, v=v2)</code> 与 S2，S3</li>
<li>S1 将 v2 被 chosen 返回给客户端</li>
<li>S2 发送 <code>Prepare(n=2.2)</code> 至 S1，S2 并收到响应：
<ul>
<li>来自 S1: acceptedProposal=1.1, acceptedValue=v1</li>
<li>来自 S2: acceptedProposal=1.1, acceptedValue=v2</li>
</ul>
</li>
<li>S2 直接选择了 v1 作为提案值</li>
<li>S2 发送 <code>Accept(n=2.2, v=v1)</code>至S1，S2，S3</li>
<li>S2 将 v1 被 chosen 返回给客户端</li>
</ul>
<p>可能出现的另一个问题是，崩溃前的请求在崩溃之后才被送到：</p>
<ul>
<li>S1 发送 <code>Prepare(n=1.1)</code> 至 S1，S2</li>
<li>S1 发送 <code>Accept(n=1.1, v=v1)</code> 至 S1</li>
<li>S1 发送  <code>Accept(n=1.1)</code> 至 S2 和 S3，但是它们并没有收到</li>
<li>S1 重启</li>
<li>S1 发送 <code>Prepare(n=1.1)</code> 至 S2，S3（并且发现还没有被接受的提案）</li>
<li>S1 发送 <code>Accept(n=1.1, v=v2)</code> 至 S2 和 S3</li>
<li>S1 将 v2 被 chosen 返回给客户端</li>
<li>现在，S2 和 S3 收到了（之前的） <code>Accept(n=1.1, v=v1)</code> 请求，并且覆盖了 acceptedValue 设为 v1。现在集群的状态是 v1 被 chosen，但是客户端收到 v2 被 chosen。</li>
</ul>
<h2 id="7-1">7.<a hidden class="anchor" aria-hidden="true" href="#7-1">#</a></h2>
<p>用 5 个节点的 Basic Paxos 举例：</p>
<ul>
<li>S1 发送 <code>Prepare(n=1.1)</code> 至 S1, S2, S3（并且发现没有接受的提案）</li>
<li>S5 发送 <code>Prepare(n=2.5)</code> 至 S3, S4, S5（并且发现没有接受的提案）</li>
<li>S5 发送 <code>Accept(n=2.5, v=X)</code> 至 S2, S3, S5，这时 S2 的 <code>minProposal</code> 应该是 2.5</li>
<li>S5 返回 X 被 chosen 给客户端</li>
<li>S1 发送 <code>Accept(n=1.1, v=Y)</code> 至 S2，这通常会被拒绝，但是如果 Accept 阶段未更新 S2 的 <code>minProposal</code>，这会被接受</li>
<li>S3 发送 <code>Prepare(n=3.3)</code> 至 S1, S2, S4（并且发现 n=1.1, v=Y）</li>
<li>S3 发送 <code>Accept(n=3.3, v=Y)</code>至 S1, S2, S3, S4, S5</li>
<li>S3 返回 Y 被 chosen 给客户端</li>
</ul>
<h2 id="8-1">8.<a hidden class="anchor" aria-hidden="true" href="#8-1">#</a></h2>
<p>这将导致新集群的活性(liveness)问题，因为新集群服务器上的 <code>firstUnchosenIndex</code> 可能小于 N+α。</p>
<p>例如，在最坏情况下，S3 可能永久故障了，而 S1 和 S2 则可能没有尝试将任何值同步到 S4 和 S5（仅使用本讲义中介绍的算法）。然后，S4 和 S5 将永远无法学习到日志记录第 1 到 N+α-1 所 chosen 的值，因为它们无法和 S1、S2 或 S3 进行通信。S4 和 S5 的状态机将永远无法超越其初始状态。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://tangwz.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://tangwz.com/post/raft-exam/">
    <span class="title">« Prev Page</span>
    <br>
    <span>Raft 作者亲自出的 Raft 试题，你能做对几道？</span>
  </a>
  <a class="next" href="https://tangwz.com/post/multi-paxos/">
    <span class="title">Next Page »</span>
    <br>
    <span>Paxos 的变种（一）：Multi-Paxos</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raft 作者出的 Paxos 的试题 on twitter"
        href="https://twitter.com/intent/tweet/?text=Raft%20%e4%bd%9c%e8%80%85%e5%87%ba%e7%9a%84%20Paxos%20%e7%9a%84%e8%af%95%e9%a2%98&amp;url=https%3a%2f%2ftangwz.com%2fpost%2fpaxos-exam%2f&amp;hashtags=%e5%88%86%e5%b8%83%e5%bc%8f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raft 作者出的 Paxos 的试题 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ftangwz.com%2fpost%2fpaxos-exam%2f&amp;title=Raft%20%e4%bd%9c%e8%80%85%e5%87%ba%e7%9a%84%20Paxos%20%e7%9a%84%e8%af%95%e9%a2%98&amp;summary=Raft%20%e4%bd%9c%e8%80%85%e5%87%ba%e7%9a%84%20Paxos%20%e7%9a%84%e8%af%95%e9%a2%98&amp;source=https%3a%2f%2ftangwz.com%2fpost%2fpaxos-exam%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raft 作者出的 Paxos 的试题 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2ftangwz.com%2fpost%2fpaxos-exam%2f&title=Raft%20%e4%bd%9c%e8%80%85%e5%87%ba%e7%9a%84%20Paxos%20%e7%9a%84%e8%af%95%e9%a2%98">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raft 作者出的 Paxos 的试题 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2ftangwz.com%2fpost%2fpaxos-exam%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raft 作者出的 Paxos 的试题 on whatsapp"
        href="https://api.whatsapp.com/send?text=Raft%20%e4%bd%9c%e8%80%85%e5%87%ba%e7%9a%84%20Paxos%20%e7%9a%84%e8%af%95%e9%a2%98%20-%20https%3a%2f%2ftangwz.com%2fpost%2fpaxos-exam%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raft 作者出的 Paxos 的试题 on telegram"
        href="https://telegram.me/share/url?text=Raft%20%e4%bd%9c%e8%80%85%e5%87%ba%e7%9a%84%20Paxos%20%e7%9a%84%e8%af%95%e9%a2%98&amp;url=https%3a%2f%2ftangwz.com%2fpost%2fpaxos-exam%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://tangwz.com/">多颗糖</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
