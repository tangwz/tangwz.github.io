<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>分布式 | 多颗糖</title>
<meta name="keywords" content="" />
<meta name="description" content="多颗糖 - 一名系统研究者的攀登之路">
<meta name="author" content="多颗糖">
<link rel="canonical" href="https://tangwz.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css" integrity="sha256-yIlj/i15RiAA/Q&#43;xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://tangwz.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://tangwz.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tangwz.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://tangwz.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://tangwz.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.89.4" />
<link rel="alternate" type="application/rss+xml" href="https://tangwz.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-72128068-1', 'auto');
	
	ga('send', 'pageview');
}
</script><meta property="og:title" content="分布式" />
<meta property="og:description" content="多颗糖 - 一名系统研究者的攀登之路" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://tangwz.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" /><meta property="og:image" content="https://tangwz.com/"/>

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://tangwz.com/"/>

<meta name="twitter:title" content="分布式"/>
<meta name="twitter:description" content="多颗糖 - 一名系统研究者的攀登之路"/>

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://tangwz.com/" accesskey="h" title="多颗糖 (Alt + H)">多颗糖</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://tangwz.com/page/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="https://tangwz.com/page/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://tangwz.com/page/search/" title="搜索">
                    <span>搜索</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://tangwz.com/">Home</a>&nbsp;»&nbsp;<a href="https://tangwz.com/tags/">Tags</a></div>
  <h1>分布式</h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Raft 作者出的 Paxos 的试题
    </h2>
  </header>
  <section class="entry-content">
    <p>试题 1. (4 分）下面的每张图都显示了一种 Multi-Paxos 服务器上可能的日志（每个条目中的数字代表 acceptedProposal 值）。考虑每份日志都是独立的，下列日志是否可能发生在正确实现的 Multi-Paxos 中？
a. b. c. d. 2. (6 分) 对于 Basic Paxos，假设一个集群有 5 台服务器，其中 3 台接受了(accepted)提案编号 5.1 和对应的提案值 X，在这种情况下，集群中的任意服务器是否有可能接受不同的值 Y ？解释你的答案。
3. (10 分) 假设 Multi-Paxos 集群选出了一个节点作为 Leader，而且没有其它 Leader。此外，假设该节点继续担任一段时间的 Leader，为日志 chosen 了很多命令，并且在这期间依然没有其它节点试图担任 Leader。
a. 在此期间，该节点最少要发送多少轮 Prepare RPC？给出解释，且尽可能精确。
b. 在此期间，该节点最多要发送多少次 Prepare RPC？给出解释，且尽可能精确。
4. (5 分) 当一个 Acceptor 使用 Proposer 提供的 firstUnchosenIndex 来标记被 chosen 的日志记录时，它必须先检查日志记录中的提案编号（acceptedProposal[i] == request.proposal）。假设它跳过了这一检查：请描述一个系统异常的情况。
5. (5 分) 假设提案编号的两个部分（自增 id 和唯一 server_id）进行了互换，即 server_id 位于高位。 a....</p>
  </section>
  <footer class="entry-footer"><span title='2020-10-26 00:00:00 +0000 UTC'>October 26, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;多颗糖</footer>
  <a class="entry-link" aria-label="post link to Raft 作者出的 Paxos 的试题" href="https://tangwz.com/post/paxos-exam/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>Paxos 的变种（一）：Multi-Paxos
    </h2>
  </header>
  <section class="entry-content">
    <p>分布式系统为了实现多副本状态机（Replicated state machine），常常需要一个多副本日志（Replicated log）系统，这个原理受到简单的经验常识启发：如果日志的内容和顺序都相同，多个进程从同一状态开始，并且以相同的顺序获得相同的输入，那么这些进程将会生成相同的输出，并且结束在相同的状态。
Replicated log =&gt; Replicated state machine
问题是：
 如何保证日志数据在每台机器上都一样？
 当然是一直在讨论的 Paxos。一次独立的 Paxos 代表日志中的一条记录，重复运行 Paxos 即可创建一个 Replicated log。
但是如果每一组提案值都通过一次 Paxos 算法实例来达成共识，每次都要两轮 RPC，会产生大量开销。所以需要对 Paxos 做一些调整解决更实际的问题，并提升性能。经过一系列优化后的 Paxos 我们称之为 Multi-Paxos。
 Multi-Paxos 的目标就是实现 Replicated log.
 下面我们从第一个问题开始。
如何确定是哪条日志记录？ 首先，Replicated log 类似一个数组，我们需要知道当次请求是在写日志的第几位。因此，Multi-Paxos 做的第一个调整就是要添加一个日志的 index 参数到 Prepare 和 Accept 阶段，表示这轮 Paxos 正在决策哪一条日志记录。
现在流程大致如下，当收到客户端带有提案值的请求时：
 找到第一个没有 chosen 的日志记录 运行 Basic Paxos，对这个 index 用客户端请求的提案值进行提案 Prepare 是否返回 acceptedValue？  是：用 acceptedValue 跑完这轮 Paxos，然后回到步骤 1 继续处理 否：chosen 客户端提案值    举个例子 如图所示，首先，服务器上的每条日志记录可能存在三种状态：...</p>
  </section>
  <footer class="entry-footer"><span title='2020-10-18 00:00:00 +0000 UTC'>October 18, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;多颗糖</footer>
  <a class="entry-link" aria-label="post link to Paxos 的变种（一）：Multi-Paxos" href="https://tangwz.com/post/multi-paxos/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>理解 Paxos（含伪代码）
    </h2>
  </header>
  <section class="entry-content">
    <p>Google Chubby 的作者 Mike Burrows 说过：There is only one consensus protocol, and that’s Paxos.
 引言 上文我们已经详细的阐述了共识问题并介绍了一些共识算法，其中 Paxos 算法是 Leslie Lamport 于 1990 年提出的共识算法，不幸的是采用希腊民主议会的比喻很明显失败了，Lamport 像写小说一样，把一个复杂的数学问题弄成了一篇带有考古色彩的历史小说。根据 Lamport 自己的描述，三个审阅人都认为该论文尽管并不重要但还有些意思，只是应该把其中所有 Paxos 相关的故事背景删掉才能发表。Lamport 对这些缺乏幽默感的人感到生气，他不打算对论文做任何修改，论文也没有得以发表。
多年后，两个在 SRC(Systems Research Center，DEC 于 1984 年创立，Lamport 也曾在此工作过)工作的人需要为他们正在构建的分布式系统寻找一些合适算法，而 Paxos 恰恰提供了他们想要的。Lamport 就将论文发给他们，他们也没觉得该论文有什么问题。
因此，Lamport 觉得论文重新发表的时间到了，&#34;The Part-Time Parliament&#34; 最终在 1998 年公开发表。
可是很多人抱怨这篇论文根本看不懂啊，人们只记住了那个奇怪的故事，而不是 Paxos 算法。Lamport 走到哪都要被人抱怨一通。于是他忍无可忍，2001 年重新发表了一篇关于 Paxos 的论文——&#34;Paxos Made Simple&#34;，这次论文中一个公式也没有，摘要也只有一句话：
 The Paxos algorithm, when presented in plain English, is very simple....</p>
  </section>
  <footer class="entry-footer"><span title='2020-09-29 00:00:00 +0000 UTC'>September 29, 2020</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;多颗糖</footer>
  <a class="entry-link" aria-label="post link to 理解 Paxos（含伪代码）" href="https://tangwz.com/post/basic-paxos/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>分布式系统的核心：共识问题
    </h2>
  </header>
  <section class="entry-content">
    <p>混乱的“一致性”问题 Consensus != Consistency
受翻译影响，网上很多讨论 paxos 或 raft 的博客使用“分布式一致性协议”或者“分布式一致性算法”这样的字眼，虽然在汉语中“达成共识”和“达成一致”是一个意思，但是必须要说明在这里讨论的是 consensus 问题，使用“共识”来表达更清晰一些。而 CAP 定理中的 C 和数据库 ACID 的 C 才是真正的“一致性”—— consistency 问题，尽管这两个 C 讨论的也不是同一个问题，但在这里不展开。
为了规范和清晰表达，在讨论 consensus 问题的时候统一使用“共识”一词。
注：在早些的文献中，共识（consensus）也叫做协商（agreement）。
共识问题 那么共识问题到底是什么呢？举个生活中的例子，小明和小王出去聚会，小明问：“小王，我们喝点什么吧？” 小王：“喝咖啡怎么样？” 小明：“好啊，那就来杯咖啡。”
在上面的场景中，小王提议喝一杯咖啡，小明表示同意，两人就“喝杯咖啡”这个问题达成共识，并根据这个结果采取行动。这就是生活中的共识。
在分布式系统中，共识就是系统中的多个节点对某个值达成一致。共识问题可以用数学语言来描述：一个分布式系统包含 n 个进程 {0, 1, 2,…, n-1}，每个进程都有一个初值，进程之间互相通信，设计一种算法使得尽管出现故障，进程们仍协商出某个不可撤销的最终决定值，且每次执行都满足以下三个性质：
 终止性（Termination）：所有正确的进程最终都会认同某一个值。 协定性（Agreement）：所有正确的进程认同的值都是同一个值。 完整性（Integrity），也称作有效性（Validity）：如果正确的进程都提议同一个值，那么所有处于认同状态的正确进程都选择该值。  完整性可以有一些变化，例如，一种较弱的完整性是认定值等于某些正确经常提议的值，而不必是所有进程提议的值。完整性也隐含了，最终被认同的值必定是某个节点提出过的。
为什么要达成共识？ 我们首先介绍分布式系统达成共识的动机。
在前文中，我们已经了解到分布式系统的几个主要难题：
 网络问题 时钟问题 节点故障问题  第一篇提到共识问题的文献1 来自于 lamport 的 “Time, Clocks and the Ordering of Events in a Distributed System2&#34;，尽管它并没有明确的提出共识(consensus)或者协商(agreement)的概念。论文阐述了在分布式系统中，你无法判断事件 A 是否发生在事件 B 之前，除非 A 和 B 存在某种依赖关系。由此还引出了分布式状态机的概念。...</p>
  </section>
  <footer class="entry-footer"><span title='2020-09-06 00:00:00 +0000 UTC'>September 6, 2020</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;多颗糖</footer>
  <a class="entry-link" aria-label="post link to 分布式系统的核心：共识问题" href="https://tangwz.com/post/consensus/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2>认识分布式系统
    </h2>
  </header>
  <section class="entry-content">
    <p>Google “三驾马车”论文发布以后，“大数据”和“分布式”就成了各种科技新闻媒体的“宠儿”，虽然如今头版已被“人工智能”、“机器学习”占据，围绕着解决大规模分布式应用技术挑战的话题还是能引起广泛的关注。
回想当初还在大学时候，我喜欢分布式而不是机器学习，主要是因为相比于机器学习大块大块的公式，分布式系统几乎不需要太多数学知识，它是一门理论模型与工程技法并重的学科。作为一个分布式系列的开篇，本文没有高深的论文和复杂的数学，只是分享我对分布式系统的一些认识。
费林分类法（Flynn’s Taxonomy） 费林根据资讯流（information stream）可分成指令（Instruction）和资料（Data）两种，把计算模型分为4类：
 单指令流单数据流计算机（SISD）：传统的单核 CPU，没有并行计算。 单指令流多数据流计算机（SIMD）：一个常见的例子就是 GPU 架构。Intel 也有支持 SIMD 的 CPU 架构。 多指令流单数据流计算机（MISD）：用多个指令操作单个数据流，几乎没有意义。 多指令流多数据流计算机（MIMD）：多个独立的 CPU 可以协作解决完全不同的子问题甚至是单一的大问题。涵盖了并行和分布式系统。  MIMD 的程序可以是同步的，也可以是异步的。能力强大的 MIMD 是目前主流的架构类型，超级计算机、并行计算机集群、分布式系统、多处理器计算机和多核计算机都属于这种类型。
MIMD 可以继续分类：
 按内存：具有共享存储器的通常称为多处理器（multiprocessor）；而不具有共享存储器的则称为多计算机(multicomputer)  多处理器系统（multi-processor） 多计算机系统（multi-computer）   连接方式：  总线式（Bus-based） 交换式（Switched）   关联程度：  紧耦合式：消息延迟短、带宽高、系统可用性高，多用于并行系统 松耦合式：消息延迟长、带宽更低、部分组件可能发生故障而不影响其他组件，多用于分布式系统    可以发现，我们要讨论的分布式系统，就是 MIMD 类型架构中 Bus-based multicomputers 和 Switched multicomputers
什么是分布式系统？ 提到分布式系统我们常常会想到很多大型的系统，比如说搜索引擎，你知道它背后肯定不止一台服务器进行处理，也知道微博、微信和淘宝背后是多个大型数据中心。这种观点当然是正确的。但是分布式系统不一定是大规模的，一个家用的 NAS 服务器也是分布式系统，甚至和你电脑连接的蓝牙键盘也是分布式系统。
在《分布式系统：概念与设计》一书中，对分布式系统做了如下定义：
 分布式系统是其组件分布在连网的计算机上，组件之间通过传递消息进行通信和协调的系统。
 通常有以下特点：
 不共享内存（只能通过网络通信） 不共享时钟 不共享操作系统  为什么需要分布式系统？ 有时候，并不是仅仅因为觉得便宜而将多台计算机连接在一起。建立分布式系统有真正的好处：...</p>
  </section>
  <footer class="entry-footer"><span title='2020-08-18 00:00:00 +0000 UTC'>August 18, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;多颗糖</footer>
  <a class="entry-link" aria-label="post link to 认识分布式系统" href="https://tangwz.com/post/intro-distributed-system/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="https://tangwz.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">« Prev Page</a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://tangwz.com/">多颗糖</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
